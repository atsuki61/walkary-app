# Walkary - 歩数管理アプリケーション

## 概要

Walkary は、ユーザーの歩数を記録・管理し、目標達成をサポートする Web アプリケーションです。
日々の歩数を記録し、目標達成度を可視化することで、健康的な生活習慣の維持をサポートします。

### 本番環境 URL

## https://django-render-vucj.onrender.com/

## 使用技術

### バックエンド

- **Python**: 3.11.2
- **Django**: 5.1.2
- **Gunicorn**: WSGI サーバー

### データベース

- **PostgreSQL**: 本番環境（Render.com）
- **SQLite**: 開発環境

### フロントエンド

- **HTML5/CSS3**: レスポンシブデザイン
- **JavaScript**: インタラクティブな機能実装

### インフラ・デプロイ

- **Render.com**: クラウドホスティング
- **WhiteNoise**: 静的ファイル配信
- **dj-database-url**: データベース接続管理
- **python-decouple / django-environ**: 環境変数管理

### 主要ライブラリ

- **psycopg2-binary**: PostgreSQL 接続
- **dj-static**: 静的ファイル管理

---

## システム構成図

```
┌─────────────────────────────────────────────────────────┐
│                     クライアント（ブラウザ）                │
│              HTML / CSS / JavaScript                     │
└────────────────────┬────────────────────────────────────┘
                     │ HTTP/HTTPS
                     ▼
┌─────────────────────────────────────────────────────────┐
│                    Render.com (ホスティング)              │
│  ┌──────────────────────────────────────────────────┐  │
│  │         Django Application (Gunicorn)            │  │
│  │  ┌──────────────┐  ┌──────────────┐            │  │
│  │  │   Views      │  │   Models     │            │  │
│  │  │   Forms      │  │   URLs       │            │  │
│  │  └──────────────┘  └──────────────┘            │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │         WhiteNoise (静的ファイル配信)              │  │
│  └──────────────────────────────────────────────────┘  │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│              PostgreSQL Database (Render.com)            │
│  ┌──────────────────┐  ┌──────────────────┐          │
│  │  UserProfile     │  │  WalkarySteps    │          │
│  │  - name          │  │  - user          │          │
│  │  - age           │  │  - date          │          │
│  │  - height        │  │  - steps         │          │
│  │  - weight        │  │                  │          │
│  │  - gender        │  │                  │          │
│  │  - goal          │  │                  │          │
│  └──────────────────┘  └──────────────────┘          │
└─────────────────────────────────────────────────────────┘
```

### ディレクトリ構造

```
walkary-app/
├── walkary/              # メインアプリケーション
│   ├── models.py         # データモデル（UserProfile, WalkarySteps）
│   ├── views.py          # ビュー（各ページの処理）
│   ├── forms.py          # フォーム（ユーザー登録、ログイン、プロフィール）
│   ├── urls.py           # URLルーティング
│   └── migrations/       # データベースマイグレーション
├── testproject/          # プロジェクト設定
│   ├── settings.py       # Django設定
│   └── urls.py           # プロジェクトURL設定
├── templates/            # HTMLテンプレート
│   └── walkary/
│       ├── index.html    # トップページ
│       ├── login.html    # ログインページ
│       ├── create.html   # 新規登録ページ
│       ├── home.html     # ホーム画面
│       ├── map.html      # 地図画面
│       ├── graph.html    # グラフ画面
│       └── mypage.html   # マイページ
├── static/               # 静的ファイル
│   └── walkary/
│       ├── css/          # スタイルシート
│       ├── js/           # JavaScript
│       └── icons/        # アイコン画像
├── requirements.txt      # Python依存関係
├── render.yaml          # Render.comデプロイ設定
└── build.sh             # ビルドスクリプト
```

---

## 機能一覧

### 認証機能

- **ユーザー登録**: 新規アカウント作成
- **ログイン**: 既存ユーザーの認証
- **ログアウト**: セッション終了
- **セッション管理**: Django 標準のセッション管理

### ユーザープロフィール管理

- **プロフィール登録・編集**:
  - 名前
  - 年齢
  - 身長（cm）
  - 体重（kg）
  - 性別（男性/女性/その他）
  - 目標歩数（m）

### 歩数管理機能

- **歩数記録**: 日々の歩数をデータベースに保存
- **歩数表示**: 現在の歩数を表示
- **目標達成度の可視化**: 円形プログレスバーで目標達成度を表示
- **残り歩数の表示**: 目標までの残り歩数を表示

### ホーム画面機能

- **歩数表示**: 本日の歩数を表示
- **目標達成度**: 円形プログレスバーで視覚的に表示
- **歩行距離表示**: 歩数から距離（m）を計算して表示
- **消費カロリー計算**:
  - 歩行時の消費カロリー
  - ランニング時の消費カロリー
- **ルート作成**: 地図画面への遷移

### 地図機能

- **ルート作成**: 地図上でルートを設定
- **距離計算**: ルートの距離を計算
- **歩数換算**: 距離から歩数を計算（ユーザーの身長を考慮）

### グラフ機能

- **歩数推移の可視化**: 過去の歩数データをグラフで表示
- **日付別データ表示**: 日付ごとの歩数を確認

### マイページ機能

- **プロフィール編集**: ユーザー情報の更新
- **目標設定**: 目標歩数の変更

---

## 非機能要件

### セキュリティ

- **CSRF 対策**: Django 標準の CSRF トークン実装
- **認証必須ページ**: ログイン必須ページへのアクセス制御
- **環境変数管理**: 機密情報（SECRET_KEY、データベース接続情報）の環境変数化
- **パスワードバリデーション**: Django 標準のパスワード強度チェック
- **SQL インジェクション対策**: Django ORM による安全なクエリ実行

### パフォーマンス

- **静的ファイル最適化**: WhiteNoise による静的ファイル配信
- **データベース最適化**: 適切なインデックス設定
- **レスポンシブデザイン**: モバイル・タブレット・デスクトップ対応

### 可用性

- **エラーハンドリング**: 適切な例外処理とエラーメッセージ表示
- **データ整合性**: データベース制約による整合性保証

### 保守性

- **コード構造**: Django のベストプラクティスに準拠
- **テンプレート継承**: 共通レイアウトの再利用
- **環境分離**: 開発環境と本番環境の設定分離

### デプロイ

- **自動デプロイ**: Render.com の自動デプロイ機能
- **環境変数管理**: Render.com の環境変数設定
- **データベースマイグレーション**: 自動マイグレーション実行

---

## システムの再現手順

本システムを再現するための基本的な流れ。

### 1. GitHub からリポジトリをクローン

```bash
git clone https://github.com/kcg-c-seminar-34/2024C24.git
cd 2024C24
```

### 2. 環境変数の設定

`.env.example` をもとに `.env` ファイルを作成し、適切な値を設定

必要な環境変数:

- `SECRET_KEY`: Django のシークレットキー
- `DATABASE_URL`: データベース接続 URL（開発環境では SQLite を使用可能）
- `SUPERUSER_NAME`: スーパーユーザー名
- `SUPERUSER_EMAIL`: スーパーユーザーのメールアドレス
- `SUPERUSER_PASSWORD`: スーパーユーザーのパスワード

### 3. 仮想環境の作成・依存関係のインストール

```bash
python -m venv myvenv
.\myvenv\Scripts\activate  # Windows
# source myvenv/bin/activate  # Linux/Mac
pip install -r requirements.txt
```

### 4. データベースのマイグレーション

```bash
python manage.py migrate
```

### 5. 開発サーバーの起動

```bash
python manage.py runserver
```

ブラウザで `http://127.0.0.1:8000/` にアクセスして動作確認

---

## Render.com へのデプロイ手順

### 1. GitHub リポジトリの準備

- GitHub のアカウントを作成
- リポジトリを作成し、コードをプッシュ

### 2. Render.com での設定

1. Render.com にサインイン（GitHub アカウントで連携）
2. **Blueprints**を選択し、**New Blueprints instance**をクリック
3. **Connect a repository**で先ほどプッシュしたリポジトリを接続
4. **Service Group Name**に`render.yaml`で記載されている`services`の`name`（`django_render`）を入力

### 3. 環境変数の設定

1. Dashboard に`django_render`が表示されたら、クリックして**Environment**をクリック
2. **Environment Variables**の`PYTHON_VERSION`を`3.11.9`に変更
3. **Environment Variables**に以下を追加:
   - `SUPERUSER_NAME`: `admin`
   - `SUPERUSER_EMAIL`: `admin@example.com`
   - `SUPERUSER_PASSWORD`: `admin1111`
4. **Save only**で保存

### 4. デプロイ実行

1. **Manual Deploy**ボタンの**Deploy last commit**でデプロイ
2. デプロイ完了後、Render が自動生成した URL にアクセスして動作確認

---

## ライセンス

このプロジェクトは教育目的で開発されています。

---

## 更新履歴

- 2025/2/10: 初版作成（西田圭佑）
- 2025/12/12: 概要を追加（塩原碧月）
